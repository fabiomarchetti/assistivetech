# ğŸ“‹ Sessione di Lavoro - 19 Ottobre 2025

## ğŸ¯ Obiettivo Sessione
Configurazione e risoluzione problemi ambiente locale MAMP per lo sviluppo dell'applicazione AssistiveTech.it su nuovo PC.

---

## âœ… Problemi Risolti

### 1. **Configurazione Ambiente Locale MAMP**

**Problema**: Applicazione non accessibile su nuovo PC locale.

**Soluzioni implementate**:
- âœ… Porta Apache MAMP: `8888` (invece di 80)
- âœ… Porta MySQL MAMP: `3306` (invece di 8889)
- âœ… URL corretto: `http://localhost:8888/Assistivetech/`
- âœ… Database locale: `assistivetech_local`

**File modificati**:
- `api/config.php` - Configurazione database e BASE_PATH

---

### 2. **Configurazione Database Multi-Ambiente**

**Problema**: Conflitto tra database locale e cloud, config override forzava connessione cloud.

**Soluzioni implementate**:
- âœ… Flag `USA_DB_LOCALE = true` in `config.php` per usare database locale
- âœ… File `config.override.php` rinominato in `config.override.php.disabled`
- âœ… Database locale funzionante senza interferenze

**Configurazione Database Locale**:
```php
Host: localhost
User: root
Pass: root
Database: assistivetech_local
Port: 3306
```

---

### 3. **Import Tabella Categorie Esercizi**

**Problema**: Tabella `categorie_esercizi` mancante nel database locale.

**Soluzione**:
- âœ… Estratto schema da export `assistivetech_local.sql`
- âœ… Corretto collation: `utf8mb4_0900_ai_ci` â†’ `utf8mb4_unicode_ci` (compatibilitÃ  MySQL)
- âœ… Import tramite phpMyAdmin riuscito
- âœ… Script SQL: `import_categorie_esercizi.sql`

---

### 4. **Link Categorie ed Esercizi - Errore 404**

**Problema**: Link nel database senza prefisso `/Assistivetech/` causavano errore 404 in locale.

**Causa**:
- Database aveva link: `/training_cognitivo/...`
- Locale MAMP richiede: `/Assistivetech/training_cognitivo/...`

**Soluzione**:
- âœ… Script SQL: `fix_link_database.sql`
- âœ… Aggiunta automatica prefisso `/Assistivetech/` a tutti i link

```sql
UPDATE categorie_esercizi
SET link = CONCAT('/Assistivetech', link)
WHERE link NOT LIKE '/Assistivetech/%';

UPDATE esercizi
SET link = CONCAT('/Assistivetech', link)
WHERE link NOT LIKE '/Assistivetech/%';
```

---

### 5. **Sistema Auto-Generazione Cartelle**

**Problema**: BASE_PATH vuoto in `config.php` generava link senza `/Assistivetech/`.

**Soluzione**:
- âœ… Modificato `api/config.php` linea 43 e 61:
  ```php
  // PRIMA (errato)
  define('BASE_PATH', '');

  // DOPO (corretto)
  define('BASE_PATH', '/Assistivetech');
  ```

**Risultato**:
- âœ… Creazione categorie genera link: `/Assistivetech/training_cognitivo/[categoria]/`
- âœ… Creazione esercizi genera link: `/Assistivetech/training_cognitivo/[categoria]/[esercizio]/`
- âœ… Cartelle create automaticamente con permessi corretti (0775/0664)
- âœ… Template HTML generati automaticamente

---

### 6. **Fix Link Esercizi Veicoli**

**Problema**: Link database non corrispondevano ai path reali delle cartelle.

**Esempi**:
- Link DB: `cerca_veicoli_di_mare` â†’ Path reale: `veicoli_mare`
- Link DB: `cerca_veicoli_di_terra` â†’ Path reale: `veicoli`

**Soluzioni**:

**A) Correzione Database** (Definitiva):
- âœ… Script SQL: `fix_veicoli_links.sql`
- âœ… Aggiornati link per puntare ai path corretti con `setup.html`

```sql
UPDATE esercizi
SET link = '/Assistivetech/training_cognitivo/categorizzazione/veicoli_mare/setup.html'
WHERE nome_esercizio = 'cerca veicoli di mare';
```

**B) Correzione Funzione API** (Fallback):
- âœ… Modificato `api/api_esercizi.php` - funzione `normalizeLink()`
- âœ… Cambiato da `strpos() === 0` a `strpos() !== false`
- âœ… Supporta redirect automatico per link storici

---

## ğŸ“„ File Creati Durante la Sessione

### Script SQL
1. **`fix_link_database.sql`** - Aggiunge `/Assistivetech/` ai link (locale)
2. **`prepare_for_aruba.sql`** - Rimuove `/Assistivetech/` dai link (produzione)
3. **`import_categorie_esercizi.sql`** - Import tabella categorie con collation corretta
4. **`fix_test_memoria_links.sql`** - Fix link categoria/esercizio di test
5. **`fix_veicoli_links.sql`** - Correzione link esercizi veicoli

### Documentazione
1. **`DEPLOY_ARUBA.md`** - Guida completa deploy su Aruba (step-by-step)
2. **`export_for_aruba.php`** - Guida visuale deploy nel browser
3. **`SESSIONE_2025-10-19.md`** - Questo file

### File di Test/Diagnostica
1. **`test_connection.php`** - Verifica connessione database
2. **`test_esercizi.php`** - Verifica relazioni database
3. **`test_api_esercizi.html`** - Test API esercizi
4. **`test_link_diretti.html`** - Test link esercizi
5. **`check_veicoli_mare.php`** - Diagnostica esercizio veicoli mare
6. **`crea_cartelle_esercizi.php`** - Tool creazione cartelle mancanti

---

## ğŸ”§ Configurazione Finale

### File `api/config.php` (Locale MAMP)
```php
define('USA_DB_LOCALE', true); // true = database locale

// Database locale
$host = 'localhost';
$username = 'root';
$password = 'root';
$database = 'assistivetech_local';
$port = 3306;

// Base path per MAMP
define('BASE_PATH', '/Assistivetech');
```

### File `api/config.php` (Produzione Aruba)
```php
// Rileva automaticamente ambiente produzione

// Database Aruba
$host = '31.11.39.242';
$username = 'Sql1073852';
$password = '5k58326940';
$database = 'Sql1073852_1';
$port = 3306;

// Base path produzione (root)
define('BASE_PATH', '');
```

---

## ğŸš€ Sistema Auto-Generazione Funzionante

### Creazione Categoria
Quando crei una categoria dal pannello admin:

1. âœ… **Genera link**: `/Assistivetech/training_cognitivo/[nome_sanitizzato]/`
2. âœ… **Crea cartella**: `C:\MAMP\htdocs\Assistivetech\training_cognitivo\[nome_sanitizzato]\`
3. âœ… **Genera index.html**: Template Bootstrap con header categoria
4. âœ… **Salva nel database**: Con link corretto
5. âœ… **Log operazione**: `logs/categorie_esercizi.log`

**Esempio**:
- Input: "Test Memoria"
- Cartella: `training_cognitivo/test_memoria/`
- Link: `/Assistivetech/training_cognitivo/test_memoria/`

---

### Creazione Esercizio
Quando crei un esercizio dal pannello admin:

1. âœ… **Genera link**: `/Assistivetech/training_cognitivo/[categoria]/[esercizio]/`
2. âœ… **Crea struttura completa**:
   ```
   esercizio/
   â”œâ”€â”€ index.html (pagina segnaposto HTML/Bootstrap)
   â”œâ”€â”€ pubspec.yaml (config Flutter)
   â”œâ”€â”€ lib/main.dart (app Flutter segnaposto)
   â”œâ”€â”€ web/manifest.json (config PWA)
   â”œâ”€â”€ assets/images/ (directory risorse)
   â””â”€â”€ README.md (documentazione)
   ```
3. âœ… **Template segnaposto**: Gradiente viola, icona cervello, bottoni "Inizia" e "Istruzioni"
4. âœ… **Permessi corretti**: 0775 (directory), 0664 (file)
5. âœ… **Salva nel database**: Con link corretto
6. âœ… **Log operazione**: `logs/esercizi.log`

**Esempio**:
- Input: "Ricorda Sequenza" in categoria "Test Memoria"
- Cartella: `training_cognitivo/test_memoria/ricorda_sequenza/`
- Link: `/Assistivetech/training_cognitivo/test_memoria/ricorda_sequenza/`

---

## ğŸ“Š Test Eseguiti e Verificati

### âœ… Test Database
- [x] Connessione database locale funzionante
- [x] Tutte le tabelle presenti e popolate
- [x] Relazioni foreign key funzionanti
- [x] Link categorie corretti con `/Assistivetech/`
- [x] Link esercizi corretti con `/Assistivetech/`

### âœ… Test Creazione Categorie
- [x] Categoria "Test Memoria" creata con successo
- [x] Cartella auto-generata
- [x] index.html template generato
- [x] Link funzionante nel browser

### âœ… Test Creazione Esercizi
- [x] Esercizio "Ricorda Sequenza" creato con successo
- [x] Struttura completa auto-generata
- [x] Template HTML segnaposto funzionante
- [x] Link funzionante nel browser

### âœ… Test Link Esistenti
- [x] Esercizi categorizzazione funzionanti
- [x] Esercizi veicoli (terra, mare, aria) corretti
- [x] Esercizi causa-effetto funzionanti
- [x] Tutte le categorie aprono correttamente

---

## ğŸŒ Procedura Deploy su Aruba

### STEP 1: Preparazione Database
```bash
# In phpMyAdmin locale
1. Esegui: prepare_for_aruba.sql
2. Esporta database â†’ assistivetech_production.sql
```

### STEP 2: Upload FTP
```
Host: ftp.assistivetech.it
User: 7985805@aruba.it
Pass: Filohori33!
Port: 21

Upload:
- training_cognitivo/ â†’ /training_cognitivo/
- api/ â†’ /api/
- admin/ â†’ /admin/
- agenda/ â†’ /agenda/
- index.html, login.html, dashboard.html, .htaccess
```

### STEP 3: Import Database Aruba
```bash
# Su http://mysql.aruba.it
1. Login con Sql1073852 / 5k58326940
2. Database: Sql1073852_1
3. Importa: assistivetech_production.sql
```

### STEP 4: Verifica Produzione
```
https://assistivetech.it/
https://assistivetech.it/training_cognitivo/
https://assistivetech.it/admin/
```

### STEP 5: Ritorno in Locale
```bash
# In phpMyAdmin locale
Esegui: fix_link_database.sql
# Riaggiunge /Assistivetech/ ai link
```

---

## ğŸ” Credenziali di Sistema

### Database Locale (MAMP)
```
Host: localhost
Port: 3306
User: root
Pass: root
Database: assistivetech_local
phpMyAdmin: http://localhost:8888/phpMyAdmin/
```

### Database Produzione (Aruba)
```
Host: 31.11.39.242
Port: 3306
User: Sql1073852
Pass: 5k58326940
Database: Sql1073852_1
phpMyAdmin: http://mysql.aruba.it
```

### FTP Aruba
```
Host: ftp.assistivetech.it
User: 7985805@aruba.it
Pass: Filohori33!
Port: 21
```

### Account Sviluppatore
```
Email: marchettisoft@gmail.com
Pass: Filohori11!
Ruolo: sviluppatore (accesso totale)
```

---

## ğŸ“ Note Importanti

### Formato Date Database
Il sistema usa **formato italiano** per le date:
- `data_registrazione`: `dd/mm/yyyy` (es. "13/09/2024")
- `ultimo_accesso`: `dd/mm/yyyy HH:mm:ss` (es. "13/09/2024 15:30:45")
- `data_creazione`: `dd/mm/yyyy HH:mm:ss`

### Collation Database
Usare sempre: **`utf8mb4_unicode_ci`**
- Compatibile con tutte le versioni MySQL
- NON usare `utf8mb4_0900_ai_ci` (solo MySQL 8+)

### Permessi File
- **Directory**: `0775` (rwxrwxr-x)
- **File**: `0664` (rw-rw-r--)

### BASE_PATH
- **Locale MAMP**: `/Assistivetech`
- **Produzione Aruba**: `` (vuoto, root)
- Mai modificare manualmente - gestito automaticamente da `config.php`

---

## ğŸ¯ FunzionalitÃ  Verificate e Funzionanti

âœ… **Sistema Autenticazione Multi-Ruolo**
- Login con redirect automatico per ruolo
- 4 ruoli: sviluppatore, amministratore, educatore, paziente
- Sessione localStorage browser

âœ… **Gestione Categorie Esercizi**
- CRUD completo dal pannello admin
- Auto-generazione cartelle e template
- Link automatici con BASE_PATH corretto

âœ… **Gestione Esercizi**
- CRUD completo dal pannello admin
- Auto-generazione struttura Flutter/HTML completa
- Template segnaposto HTML con Bootstrap
- Link automatici con BASE_PATH corretto

âœ… **Sistema Training Cognitivo**
- Navigazione categorie funzionante
- Visualizzazione esercizi per categoria
- Apertura esercizi da categoria
- Apertura esercizi da pannello admin

âœ… **Database**
- Tutte le tabelle presenti e popolate
- Foreign key funzionanti
- Indici performance attivi
- Backup e export funzionanti

---

## ğŸš¨ Troubleshooting Comune

### Errore 404 su link esercizi
**Causa**: Link database senza `/Assistivetech/`
**Soluzione**: Eseguire `fix_link_database.sql`

### Errore collation unknown
**Causa**: Collation `utf8mb4_0900_ai_ci` non supportata
**Soluzione**: Usare `utf8mb4_unicode_ci`

### Cartelle non create automaticamente
**Causa**: `BASE_PATH` vuoto in `config.php`
**Soluzione**: Verificare `define('BASE_PATH', '/Assistivetech');` in locale

### Database non si connette
**Causa**: Porta MySQL sbagliata o `config.override.php` attivo
**Soluzione**:
- Verificare porta 3306
- Disabilitare `config.override.php`
- Controllare `USA_DB_LOCALE = true`

### Link veicoli danno 404
**Causa**: Path database diverso da path reale
**Soluzione**: Eseguire `fix_veicoli_links.sql`

---

## ğŸ“š File di Riferimento

### Script SQL
- `fix_link_database.sql` - Aggiunge `/Assistivetech/` (locale)
- `prepare_for_aruba.sql` - Rimuove `/Assistivetech/` (deploy)
- `fix_veicoli_links.sql` - Corregge link esercizi veicoli
- `import_categorie_esercizi.sql` - Import tabella categorie

### Documentazione
- `DEPLOY_ARUBA.md` - Guida deploy completa
- `README.md` - Documentazione progetto
- `CLAUDE.md` - Istruzioni per Claude Code
- `agenda/CLAUDE.md` - Documentazione app Flutter Agenda

### Configurazione
- `api/config.php` - Config database e ambiente
- `.htaccess` - Configurazione Apache
- `pubspec.yaml` - Dipendenze Flutter agenda

---

## ğŸ‰ Risultato Finale

**Sistema completamente operativo in ambiente locale MAMP!**

âœ… Tutte le funzionalitÃ  testate e funzionanti
âœ… Auto-generazione categorie/esercizi perfetta
âœ… Link corretti con prefisso `/Assistivetech/`
âœ… Deploy su Aruba preparato e documentato
âœ… Procedura reversibile locale â†” produzione

**Pronto per sviluppo e deploy!** ğŸš€

---

## ğŸ“… Prossimi Step Suggeriti

1. âœ… Test creazione categoria/esercizio "Test Attenzione" â†’ "Trova Differenze"
2. ğŸ”„ Deploy completo su Aruba con procedura documentata
3. ğŸ’» Sviluppo contenuti specifici esercizi esistenti
4. ğŸ“± Aggiornamento app Flutter Agenda se necessario
5. ğŸ§ª Test completo sistema in produzione

---

**Data**: 19 Ottobre 2025
**Durata Sessione**: ~3 ore
**Problemi Risolti**: 6 principali + vari fix minori
**File Creati**: 13 (script SQL + documentazione + test)
**Status**: âœ… Sistema operativo e pronto per produzione

---

_Generato automaticamente da Claude Code_
